{"componentChunkName":"component---src-templates-blog-post-js","path":"/2019-06-09--mysql-root-password/","result":{"data":{"site":{"siteMetadata":{"title":"Concigel's Blog"}},"markdownRemark":{"id":"44279662-f39e-5054-a416-36fc78c49922","excerpt":"MySQL の root パスワード変更をするときにハマってしまったのでメモしておく。\n実行環境は Ubuntu 19.04 MySQL 5.7。 MySQL を止める パスワードなしでログインできる MySQL を起動する UNIX…","html":"<p>MySQL の root パスワード変更をするときにハマってしまったのでメモしておく。\n実行環境は Ubuntu 19.04 MySQL 5.7。</p>\n<h2>MySQL を止める</h2>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">sudo</span> systemctl stop mysql</code></pre></div>\n<h2>パスワードなしでログインできる MySQL を起動する</h2>\n<p>UNIX ドメインソケットが読み書きできないので、所有権を設定するのを忘れないように。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">sudo</span> <span class=\"token function\">mkdir</span> <span class=\"token parameter variable\">-p</span> /var/run/mysqld\n$ <span class=\"token function\">sudo</span> <span class=\"token function\">chown</span> mysql:mysql /var/run/mysqld\n$ <span class=\"token function\">sudo</span> mysqld_safe --skip-grant-tables <span class=\"token operator\">&amp;</span></code></pre></div>\n<h2>MySQL へ接続する</h2>\n<p>この方法でパスワード変更した場合は、ネイティブ認証プラグインが設定されていないので\nそのプラグインの組み込みもする。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ mysql <span class=\"token parameter variable\">-uroot</span> mysql\nmysql<span class=\"token operator\">></span> update user <span class=\"token builtin class-name\">set</span> <span class=\"token assign-left variable\">authentication_string</span><span class=\"token operator\">=</span>PASSWORD<span class=\"token punctuation\">(</span><span class=\"token string\">\"mynewpassword\"</span><span class=\"token punctuation\">)</span> where <span class=\"token assign-left variable\">user</span><span class=\"token operator\">=</span><span class=\"token string\">'root'</span><span class=\"token punctuation\">;</span>\nmysql<span class=\"token operator\">></span> update user <span class=\"token builtin class-name\">set</span> plugin <span class=\"token operator\">=</span> <span class=\"token string\">'mysql_native_password'</span> where user <span class=\"token operator\">=</span> <span class=\"token string\">'root'</span><span class=\"token punctuation\">;</span>\nmysql<span class=\"token operator\">></span> flush privileges<span class=\"token punctuation\">;</span>\nmysql<span class=\"token operator\">></span> quit</code></pre></div>\n<h2>MySQL を再起動する。</h2>\n<p>mysqld_safe でけでなく、mysqld も起動しているのでそれも停止する。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">sudo</span> <span class=\"token function\">kill</span> <span class=\"token parameter variable\">-9</span> <span class=\"token operator\">&lt;</span>mysqld_safe_pid<span class=\"token operator\">></span>\n$ <span class=\"token function\">ps</span> aux <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> mysql\n$ <span class=\"token function\">sudo</span> <span class=\"token function\">kill</span> <span class=\"token parameter variable\">-9</span> <span class=\"token operator\">&lt;</span>mysqld_pid<span class=\"token operator\">></span>\n$ <span class=\"token function\">sudo</span> systemctl start mysql</code></pre></div>\n<p>ログインできるようになれば完了</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ mysql <span class=\"token parameter variable\">-uroot</span> <span class=\"token parameter variable\">-pmynewpassword</span></code></pre></div>\n<h2>補足１</h2>\n<p>MySQL の初期パスワードは /var/log/mysqld.log にある。筆者は消してしまっていてわからなくなったので上記手順で行った。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">$ <span class=\"token function\">cat</span> /var/log/mysqld.log <span class=\"token operator\">|</span> <span class=\"token function\">grep</span> <span class=\"token string\">'temporary password'</span></code></pre></div>\n<h2>補足 2</h2>\n<p>MySQL のパスワードポリシーは初期だと 文字列長 8、大文字・小文字・数値・特殊文字を含む必要があるため変更するには、グローバル変数を変更する。</p>\n<div class=\"gatsby-highlight\" data-language=\"bash\"><pre class=\"language-bash\"><code class=\"language-bash\">mysql<span class=\"token operator\">></span> SET GLOBAL <span class=\"token assign-left variable\">validate_password_length</span><span class=\"token operator\">=</span><span class=\"token number\">4</span><span class=\"token punctuation\">;</span>\nmysql<span class=\"token operator\">></span> SET GLOBAL <span class=\"token assign-left variable\">validate_password_policy</span><span class=\"token operator\">=</span>LOW<span class=\"token punctuation\">;</span></code></pre></div>","frontmatter":{"title":"mysql のパスワード変更","date":"June 09, 2019","description":"MySQL の root パスワード変更をするときにハマってしまったのでメモしておく。"}},"previous":{"fields":{"slug":"/2019-04-19--ubuntu19-04/"},"frontmatter":{"title":"Ubuntu19.04"}},"next":{"fields":{"slug":"/2019-09-01--flutter-image-icon/"},"frontmatter":{"title":"Flutter のアイコン作成"}}},"pageContext":{"id":"44279662-f39e-5054-a416-36fc78c49922","previousPostId":"4640385e-6fb0-528c-b830-98d2e045a918","nextPostId":"b8a5e39b-3f1a-5695-b3cb-2810742829d2"}},"staticQueryHashes":["2841359383","3257411868"],"slicesMap":{}}